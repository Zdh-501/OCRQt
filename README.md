# 一、应用架构


<img width="481" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/0ba59dca-2d1b-43e0-9989-c828ca33f7e2">

# 二、软件识别检查流程
## 1)流程示意图：

<img width="482" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/65876f67-0ffb-47b6-9237-3972b3188da1">

## 2)流程说明：
| ID    | 业务步骤         | 步骤说明                                                                                   | 功能设计章节                |
|-------|----------------|------------------------------------------------------------------------------------------|--------------------------|
| 1.2.1 | 接收任务信息     | 三期设备接收任务后，自动在任务列表中显示接收到的任务                                             | 三期信息识别          |
| 1.2.2 | 更换检测识别模型 | 在需要更换模型的场合进行此步操作，例如：新增产线初次使用、存在其他精度更高的模型                        |  三期信息识别          |
| 1.2.3 | 选择执行任务     | 从任务列表中选择要执行的任务，选择后界面会自动跳转到检测界面                                       | 三期信息识别          |
| 1.2.4 | 发送双面产品检测结果 | 若产品需要双面检测，则在拍摄检测过程中，需要根据提示按规定顺序进行拍摄，如先拍摄“批号面”，再拍摄“日期面”，同一产品拍摄完两面后在进行检测上传 |三期信息识别          |
| 1.2.5 | 发送单面产品检测结果 | 若产品为单面检测，则每拍摄完一次，就需要进行一次的检测上传操作                                       |  三期信息识别          |
| 4.4.2 | 三期识别结果信息   | （三期识别设备->BES）                                                                  |  三期信息识别          |

# 三、三期信息识别软件
## 功能简述

1. 接收三期识别任务
2. 选择任务后登录账号开始执行
3. 执行产品三期信息识别检测
4. 发送三期识别结果
5. 查询三期识别记录

## 功能使用场景

- 从系统接收到任务信息后，开始选取任务进行检测并上传结果。

## 界面图例

(a) 登录窗口

<img width="113" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/52839637-236a-4dba-b9ea-b30861c31c43">

(b) 任务列表界面

<img width="445" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/9c9f63b6-12a7-49d8-92d2-faecb722491e">

(c) 模型更改

<img width="315" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/f660b6be-32dd-4fac-aff8-27fb621df2aa">

(d) 单面检测界面

<img width="325" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/93fd85e2-083b-4568-aaec-8fd0541fc496">

(e) 双面检测界面 

<img width="328" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/fae0fc43-ca93-42fe-873d-1c80dd64a07b">

(f) 提示信息

<img width="337" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/45c25a6c-1e14-4790-887a-bdcf05740e4d">

<img width="308" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/9e7b031e-d342-4c38-b74b-0c452a4cd767">

<img width="307" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/b2a0f672-7c91-43a9-af01-e22f89c05084">

(g) 检测记录界面

<img width="331" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/77a918d4-45b0-4f07-b86d-633245ec9efe">

(h) 错误日志界面

<img width="370" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/6113e56a-f4b0-426d-a9e4-f6a38dd63e36">

(i) 用户管理界面

<img width="417" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/7fe3f6a3-669e-4111-9554-00e891d18489">

## 功能说明

1、在任务列表页面可以选择要执行的任务。在右下角“模型选择”按钮处可以选择不同模型和设置参数。在更换模型前会先进行用户验证，只有权限的用户可以进行模型修改。一般只有在特定场合才需要更换模型，如在初次使用更新产品等特殊情况需要进行模型切换。

2、在选择任务点击确定后，会先进行用户登录，登录后跳转到检测界面，右侧会有当前任务的提醒，信息无误便可进行拍照，拍完一个产品后，便可点击“开始检测”按钮进行检测上传，同时将上传结果显示在右下角。

3、如图e所示，如若是需要双面检测的产品 ，将会有“批号面”和“日期面”两个进度条标识。上面进度条代表批号面，下面进度条代表日期面，同一列代表一个产品。在拍摄完后，可点击进度条的不同部分，查看对应产品的拍摄照片。如点击“产品1”列的上边进度条块就会显示“产品1”的批号面照片，点击“产品1”列的下边进度条块就会显示“产品1”的日期面照片。

4、在产品需要双面拍摄的情况下，当一个产品的批号面拍完后，软件会自动切换到日期面页面，用户可直接进行日期面的拍摄。一个产品检测上传完系统后，不能重新拍摄检测。  

5、在产品需要双面拍摄的情况下，拍摄过程中会进行相应的提示，如图f所示，举例：当同一个产品的批号面还未进行拍摄时，此时点击产品的下边进度条则会弹出提醒，提示用户先完成产品的批号面拍摄；在前一个产品拍摄完，未进行检测上传便点击进度条中对应其他产品的列时，会弹出提醒先完成产品的检测任务；当一个产品拍摄完并且点击了“开始检测”按钮，软件会先校验用户是否正确在“批号面”页面和“日期面”页面进行产品批号和日期的对应拍摄，如若将拍摄面颠倒，或连续拍摄了两次“批号面”，又或连续拍摄了两次“日期面”等非正确操作，则会弹出提示。

6、点击右上角“检测记录”按钮，跳转到检测记录界面

## 参数说明
a) 任务列表字段

| 序号 |  字段名称     | 类型   | 用途                                   |
|------|------------|------|--------------------------------------|
| 1    | 工单号          | 字符串     | 标识任务对应的工单号                         |
| 2    | 批次号          | 字符串     | 标识任务对应的批次号                         |
| 3    | 产品编码        | 字符串     | 标识任务对应的产品编码                       |
| 4    | 产品名称        | 字符串     | 标识任务对应的产品名称                       |
| 5    | 生产线          | 字符串     | 标识任务对应的生产线                         |
| 6    | 识别任务标识符   | 字符串     | 用于区分不同任务的标识符                     |
| 7    | 识别任务key    | 数字      | 每个任务对应一个唯一的key值                |
| 8    | 识别物料类型    | 数字类型   | 标识任务检测的物料类型，10：内包材；20：小盒；30：瓶签 |
| 9    | 识别类型        | 数字      | 标识任务是检测单面，还是双面                 |
| 10   | 识别总数        | 数字      | 标识任务需要检测的数量，10：单面；20：双面   |
| 11   | 生产日期        | 字符串     | 标识任务对应产品的正确生产日期               |
| 12   | 有效期至        | 字符串     | 标识任务对应产品的正确有效期至               |
| 13   | 是否已处理      | 数字      | 标识任务完成状态，1：完成；2：未完成         |

b) 返回结果字段

| 序号 | 字段名称       | 类型 | 用途                             |
|------|--------------|-----|--------------------------------|
| 1    | 识别任务标识符 | 字符串 | 当前工单识别任务的唯一标识符       |
| 2    | 识别序号       | 字符串 | 当前任务识别的序号               |
| 3    | 工单号         | 字符串 | 当前工单号                       |
| 4    | 批次号         | 字符串 | 三期设备识别出的批次号字符串       |
| 5    | 生产日期       | 字符串 | 三期设备识别出的生产日期字符串     |
| 6    | 有效期至       | 字符串 | 三期设备识别出的有效期至字符串     |
| 7    | 图片           | 图片 | 此次检测的图片                   |
| 8    | CWID          | 字符串 | 记录操作人员的CWID             |
| 9    | 用户名称       | 字符串 | 记录操作人员的用户名称           |
| 10   | 操作时间       | 时间 | 记录操作时间                     |

c） 用户列表字段

| 序号 |字段名称   | 类型   | 用途                                         |
|------|----------|------|--------------------------------------------|
| 1    | CWID           | 字符串   | 用户的系统登录名，具有唯一性约束                  |
| 2    | 密码           | 字符串   | 用户的登录密码                                 |
| 3    | 用户名称        | 字符串   | 用户名称                                     |
| 4    | 权限           | 字符串   | 用户的权限，1：管理员  2：操作员                   |
| 5    | 激活状态        | 布尔    | 用于表示账号是否激活，1 表示激活状态，0 表示账号失效      |
| 6    | 最近登录时间    | 时间    | 记录用户最近一次的登录时间，精确到秒                |
| 7    | 失效时间        | 时间    | 根据最近一次的登录时间，记录失效时间                |

d) 错误日志表字段

| 序号 | 字段名称 | 类型   | 用途                               |
|------|--------|------|----------------------------------|
| 1    | 发生时间 | 时间   | 用于记录错误报警发生的时间               |
| 2    | 错误信息 | 字符串 | 用于记录错误信息                     |
| 3    | CWID   | 字符串 | 用户的系统登录名，具有唯一性约束          |
| 4    | 用户名称 | 字符串 | 用户名称                           |
# 四、三期识别模型创建软件
## 功能简述

1. 数据采集
2. 数据标注
3. 训练模型
4. 管理模型

## 功能使用场景

1. 在增加新产线或其他需要新模型的场景下使用。

## 界面图例
(a) 登录界面

<img width="106" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/65e58346-1e69-43a1-8603-e1487578ceb2">

(b) 数据采集界面

<img width="452" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/b58b6df9-3f1e-411b-9dbd-b1f04a429c32">

(c)  数据标注界面

<img width="453" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/882ab255-8c56-4436-975a-f70dbbaf00bf">

(d) 模型训练界面

<img width="452" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/1ca95ab7-e9b9-41e8-9af7-1aecd6907ad2">

(e) 模型管理界面

<img width="459" alt="image" src="https://github.com/Zdh-501/OCRQt/assets/58514227/30641f5f-df07-4817-bfbe-cb9f1c8128fb">

## 功能说明
### “数据采集”界面：
· 在数据采集界面中，包含了数据拍摄并导出、数据标注功能。
· 进行图像拍摄前，可通过“导出格式”下拉框进行图片格式的选择，包含jpg、png、bmp等图片格式选择，格式的选择与图像的大小有关，默认选择“jpg”格式，图像成像清晰，图像大小为1-2M左右。
· “保存路径”是指拍摄图像保存于本地的路径。注：路径名中所有的文件使用英文命名，否则标注过程中会出现问题。
· 采集通道选择：压印物料选择“normMix通道”，喷印物料选择“kd通道”。
· 曝光值已设定初值：50，采集过程中根据图像明暗进行微调。
· 点击“启动相机”，相机将会处于待机状态。
· 点击“拍照”，图像会进行拍摄并保存。
· 点击“标注数据”,将会跳转数据标注工具界面。

### “数据标注”工具界面：
· 当拍摄完一定数量照片后，点击数据集管理界面中的“数据标注”按钮，需要等待8~10s加载数据标注界面，如图b所示。
· 打开文件夹：在菜单栏点击 “文件” - "打开目录" 选择待标记图片的文件夹。
· 自动标注：点击 “自动标注”，使用模型对图片文件名前图片状态为 “X” 的图片进行自动标注。
· 手动标注：点击 “矩形标注”（推荐直接在英文模式下点击键盘中的 “W”)，用户可对当前图片中模型未检出的部分进行手动绘制标记框。点击键盘Q，则使用四点标注模式（或点击“编辑” - “四点标注”），用户依次点击4个点后，双击左键表示标注完成。
· 标记框绘制完成后，用户点击 “确认”，检测框会先被预分配一个 “待识别” 标签。
· 重新识别：将图片中的所有检测画绘制/调整完成后，点击 “重新识别”，模型会对当前图片中的所有检测框重新识别。
· 内容更改：单击识别结果，对不准确的识别结果进行手动更改。
· 确认标记：点击 “确认”，图片状态切换为 “√”，跳转至下一张。
· 删除：点击 “删除图像”，图片将会被删除至回收站。
· 导出结果：用户可以通过菜单中“文件-导出标记结果”手动导出，同时也可以点击“文件 - 自动导出标记结果”开启自动导出。手动确认过的标记将会被存放在所打开图片文件夹下的Label.txt中。在菜单栏点击 “文件” - "导出识别结果"后，会将此类图片的识别训练数据保存在crop_img文件夹下，识别标签保存在rec_gt.txt中。

### “模型训练”界面：
· 模型训练界面中，可自定义新模型的名称及存储路径，进行对应设置后便可开始训练。
· 模型属性设置包含模型名称命名的目的是区分用于文本检测和文本识别的模型，可用中文“检测”、“识别”或英文“det”、“rec”，形成命名：“检测+重要说明+v版本号”
· 训练相关路径选择：数据集路径、预训练模型需要选择本地所保存已有对应文件的路径，模型保存路径选择拟将模型存储的路径。
· 模型训练参数设置的“迭代次数”是指整个训练数据集被神经网络完整地遍历一次的次数，训练多个迭代次数的目的是让模型不断学习，提高性能，训练的“迭代次数”推荐设置在150-200之间，默认值：200
· 模型训练参数设置的“批量大小”指的是每次模型权重更新时所使用的样本数，较大的“批量大小”会加速训练，但是需要更多的内存和计算资源。训练分为文本检测和文本识别，文本检测的“批量大小”参数推荐设置为：8；文本识别的“批量大小”参数推荐设置为：64。

### “模型管理”界面：
· 在模型管理界面中显示模型的相关信息。
· 双击“模型名称”、“备注”可修改名称或增加备注信息。
· 预训练模型显示作为预训练模型的信息，本训练模块所做的模型训练都是微调训练，需要基于预训练模型进行。
· 状态列中，显示模型的训练状态“训练中”、“已完成”。
· 操作列中，点击“删除”将会删除选择模型。
· 操作列中，点击“重新训练”将会跳转“模型训练”界面，可修改参数配置，重新进行训练。
· 操作列中，点击“查看路径”显示模型所在文件夹。

## 参数说明
| 序号 | 字段名称       | 类型   | 用途                             |
|------|--------------|------|--------------------------------|
| 1    | 整数主键       | 整数   | 用于唯一地标识表中的每一行             |
| 2    | 模型名称       | 字符串 | 定义将要要训练的模型名称               |
| 3    | 预训练模型名称   | 字符串 | 基于预训练模型进行新的模型训练         |
| 4    | 备注信息       | 字符串 | 备注此次模型训练的信息                 |
| 5    | 存储路径       | 字符串 | 记录此次模型训练的存储路径             |
| 6    | 状态           | 字符串 | 标识此模型的训练是否已完成             |
| 7    | CWID          | 字符串 | 记录操作人员的CWID                |
| 8    | 用户名称       | 字符串 | 记录操作人员的用户名称               |
| 9    | 开始训练时间    | 时间   | 记录开始训练的时间，精确到秒           |

## 三期识别设备/BES集成

- **接口方式**：Webservice
- **接口数据格式**：xml
- **接口任务方式**：定时任务
- **频率**：10000ms
